---
title: "Draft Quarto document"
author: "Your Name"
format: html
---

## Header 1

General notes - settings: tools, project options, markdown --\> column
and true i de nederste to drop down

```{r setup}
library(tidyverse)
library(targets)
tar_config_set(store = here::here("_targets")) # telling where the target is stored
source(here::here("R/functions.R"))
lipidomics <- tar_read(lipidomics)
```

## Making a table

shortcut to find names: colnames("dataset")

```{r}
lipidomics |>
  group_by(metabolite) |>
  summarise(across(value, list(mean = mean, sd = sd))) |>
  mutate(across(where(is.numeric), \(x) round(x, digits = 1))) |> # runder alle numereiske værdier til 1 decimal
  mutate(MeanSD = glue::glue("{value_mean} ({value_sd})")) |> # sætter de to sammen i én værdi i tabellen og parenteserne er for at få sd i en parentes
  select(Metabolite = metabolite, "Mean SD" = MeanSD) # "nyt navn = col i data", man vælger i select det, der skal være output i tabellen
```

## function to create table1

```{r}
# Function creating a meanSD outout. The two variables wpcified is the dataset and group_by. Need the "value" column to be generic cause "value" is
create_table_descriptive_stats(lipidomics, metabolite)
```

## Result: basic stats table

```{r}
tar_read(table_descriptive_stats) |>
  knitr::kable(
    caption = "The mean and SD of metabolites in the lipidomics dataset."
  )
```

## plot of distribution

Histogram

```{r}
ggplot2::ggplot(
  lipidomics,
  ggplot2::aes(x = value)
) +
  geom_histogram() +
  facet_wrap(vars(metabolite), scales = "free") + # free: for each it can define its own axis values. facetwrap is the one we want to "group:by"
  theme_minimal()
```

## Making the histogram into a function

```{r}
# Use it like, which should give the same output as before.
create_plot_distributions(lipidomics, metabolite)
```

## Results: Distribution plot

```{r}
tar_read(plot_distributions)
```

## Preparing the data for linear regression

```{r}
lipidomics |>
  count(code, metabolite) |>
  filter(n > 1)
```

Making the values to means

```{r}
lipidomics |>
  group_by(pick(-value)) |> # grupper på alt andet end value
  summarise(value = mean(value), .groups = "keep") |> # summér value som mean af værdierne og behold kolonnerne i group_by
  ungroup()
```

## cleaning function

```{r}
# using the clean function to get the means

clean(lipidomics)
```

## c

forskel efte rat have kørt scale() function = z-score normalisering. Gns
bliver 0, og en enheds forskel er 1 SD væk fra mean

```{r}
lipidomics |>
  filter(metabolite == "Cholesterol") |>
  mutate(
    class = as.factor(class),
    value = scale(value) # mean centers meaning mean = 0 and 1 unit change = 1 SD dif.
  )
```

```{r}
just_cholesterol <- lipidomics |>
  filter(metabolite == "Cholesterol") |>
  preprocess()

# Making a OR because we set class as a function of value and family to binomial. Exponentiate = T for at få på relativ skala
glm(
  formula = class ~ value,
  data = just_cholesterol,
  family = binomial
) |>
  broom::tidy(exponentiate = TRUE) |>
  mutate(
    metabolite = unique(just_cholesterol$metabolite),
    model = format(class ~ value),
    .before = everything()
  )
```

Test

```{r}
lipidomics |>
  filter(metabolite == "Cholesterol") |>
  preprocess() |>
  fit_model(class ~ value)
```

